###################################################
# This creates and stands up the development
# docker container. Depends on the Dockerfile and
# docker-start.sh files.
###################################################

services:
  tailscale:
    extends:
      file: ../tailscale.yaml
      service: tailscale
    hostname: budget
  actual_server:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - HTTPS
    volumes:
      # Change './actual-data' below to the path to the folder you want Actual to store its data in on your server.
      # '/data' is the path Actual will look for its files in by default, so leave that as-is.
      - ${HDD_DATA_LOC:?error}/actual:/app
    healthcheck:
      # Enable health check for the instance
      test: ["CMD-SHELL", "node src/scripts/health-check.js"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: no
    network_mode: service:tailscale
